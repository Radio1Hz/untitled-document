name: deploy to untitled-document.net
on: push
jobs:
  deploy:
    name: Deploy
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0  # OR "2" -> To retrieve the preceding commit.

    - name: Get changed files
      id: changed-files
      uses: tj-actions/changed-files@v43
    # NOTE: `since_last_remote_commit: true` is implied by default and falls back to the previous local commit.

    - name: List all changed files
      env:
        ALL_CHANGED_FILES: ${{ steps.changed-files.outputs.all_changed_files }}
      run: |
        mkdir dist
        for file in ${ALL_CHANGED_FILES}; do
          VAR=$file
          DIR="$(dirname "${VAR}")" ; FILE="$(basename "${VAR}")"
          echo "[${DIR}] [${FILE}]"  
          mkdir -p dist/${DIR}
          cp $file dist/${DIR}
        done
        touch dist/commit_time.txt
    - name: Upload to untitled-document.net ftp
      uses: sebastianpopp/ftp-action@v2.0.0
      with:
        host: ${{ secrets.FTP_SERVER }}
        user: ${{ secrets.FTP_USERNAME }}
        password: ${{ secrets.FTP_PASSWORD }}
        localDir: "dist"
        remoteDir: "system.tvojstav.com/public_html"
    
